-- MySQL Script generated by MySQL Workbench
-- Wed Dec 23 19:06:40 2020
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema klobuszenskij
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema klobuszenskij
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `klobuszenskij` DEFAULT CHARACTER SET utf8 COLLATE utf8_polish_ci ;
USE `klobuszenskij` ;

-- -----------------------------------------------------
-- Table `klobuszenskij`.`Pracownicy`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `klobuszenskij`.`Pracownicy` (
  `idPracownicy` INT NOT NULL AUTO_INCREMENT,
  `Imie` VARCHAR(45) NOT NULL,
  `Nazwisko` VARCHAR(45) NOT NULL,
  `Adres` VARCHAR(45) NOT NULL,
  `Data_ur` DATE NOT NULL,
  `Kontakt` INT NOT NULL,
  `Email` VARCHAR(45) NOT NULL,
  `Dzial` ENUM('Buty', 'Bar', 'Pomoc', 'Magazyn', 'Kasa', 'Wyżej') NOT NULL,
  `Wyplata` INT NOT NULL,
  `Bonus` INT NULL,
  PRIMARY KEY (`idPracownicy`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `klobuszenskij`.`Klienci`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `klobuszenskij`.`Klienci` (
  `idKlienci` INT NOT NULL AUTO_INCREMENT,
  `Imie` VARCHAR(45) NOT NULL,
  `Nawisko` VARCHAR(45) NOT NULL,
  `Kontakt` INT NOT NULL,
  `Email` VARCHAR(45) NOT NULL,
  `HistoriaRezerwacji` VARCHAR(45) NOT NULL,
  `PESEL` INT(11) NOT NULL,
  `IloscOsob` INT NOT NULL,
  PRIMARY KEY (`idKlienci`),
  UNIQUE INDEX `PESEL_UNIQUE` (`PESEL` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `klobuszenskij`.`Sprzet`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `klobuszenskij`.`Sprzet` (
  `idSprzet` INT NOT NULL AUTO_INCREMENT,
  `Nazwa` VARCHAR(25) NOT NULL,
  `MaxGraczy` INT NOT NULL,
  `IdPracownicy` VARCHAR(45) NOT NULL COMMENT 'Opieka\n',
  `idKlienci` INT NOT NULL,
  PRIMARY KEY (`idSprzet`, `idKlienci`),
  INDEX `fk_Sprzet_Klienci1_idx` (`idKlienci` ASC) VISIBLE,
  INDEX `fk_Sprzet_Pracownicy1_idx` (`IdPracownicy` ASC) VISIBLE,
  CONSTRAINT `fk_Sprzet_Klienci1`
    FOREIGN KEY (`idKlienci`)
    REFERENCES `klobuszenskij`.`Klienci` (`idKlienci`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Sprzet_Pracownicy1`
    FOREIGN KEY (`IdPracownicy`)
    REFERENCES `klobuszenskij`.`Pracownicy` (`idPracownicy`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `klobuszenskij`.`Buty`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `klobuszenskij`.`Buty` (
  `idButy` INT NOT NULL,
  `Marka` INT NOT NULL,
  `Rozmiar` INT NOT NULL,
  `idKlienci` VARCHAR(45) NULL,
  PRIMARY KEY (`idButy`),
  INDEX `fk_Buty_Klienci_idx` (`idKlienci` ASC) VISIBLE,
  CONSTRAINT `fk_Buty_Klienci`
    FOREIGN KEY (`idKlienci`)
    REFERENCES `klobuszenskij`.`Klienci` (`idKlienci`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `klobuszenskij`.`Rezerwacja`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `klobuszenskij`.`Rezerwacja` (
  `idRezerwacja` INT NOT NULL AUTO_INCREMENT,
  `idKlienci` INT NOT NULL,
  `idSprzet` INT NOT NULL,
  `Rozpoczecie` DATETIME NOT NULL,
  `Zakonczenie` DATETIME NOT NULL,
  PRIMARY KEY (`idRezerwacja`),
  INDEX `fk_Rezerwacja_Klienci1_idx` (`idKlienci` ASC) VISIBLE,
  INDEX `fk_Rezerwacja_Sprzet1_idx` (`idSprzet` ASC) VISIBLE,
  CONSTRAINT `fk_Rezerwacja_Klienci1`
    FOREIGN KEY (`idKlienci`)
    REFERENCES `klobuszenskij`.`Klienci` (`idKlienci`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Rezerwacja_Sprzet1`
    FOREIGN KEY (`idSprzet`)
    REFERENCES `klobuszenskij`.`Sprzet` (`idSprzet`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `klobuszenskij`.`MagazynBar`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `klobuszenskij`.`MagazynBar` (
  `idBar` INT NOT NULL AUTO_INCREMENT,
  `Nazwa` VARCHAR(45) NOT NULL,
  `ZawAlk` INT NOT NULL,
  `Ilosc` INT NOT NULL,
  PRIMARY KEY (`idBar`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `klobuszenskij`.`Bar`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `klobuszenskij`.`Bar` (
  `Obsługa` INT NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`Obsługa`),
  CONSTRAINT `fk_Bar_Pracownicy1`
    FOREIGN KEY (`Obsługa`)
    REFERENCES `klobuszenskij`.`Pracownicy` (`idPracownicy`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

USE `klobuszenskij`;

DELIMITER $$
USE `klobuszenskij`$$
CREATE DEFINER = CURRENT_USER TRIGGER `klobuszenskij`.`Pracownicy_BEFORE_UPDATE` BEFORE UPDATE ON `Pracownicy` FOR EACH ROW
BEGIN
DECLARE Roznica int;
UPDATE Roznica
SET RoznicaW = (new.Wyplata - old.Wyplata);
END$$

USE `klobuszenskij`$$
CREATE DEFINER = CURRENT_USER TRIGGER `klobuszenskij`.`Buty_BEFORE_DELETE` BEFORE DELETE ON `Buty` FOR EACH ROW
BEGIN
INSERT INTO ButyArchiwum
SELECT idButy,Marka,Rozmiar,idKienci
FROM Buty
WHERE idButy=old.idButy;
END$$


DELIMITER ;

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- -----------------------------------------------------
-- Data for table `klobuszenskij`.`Pracownicy`
-- -----------------------------------------------------
START TRANSACTION;
USE `klobuszenskij`;
INSERT INTO `klobuszenskij`.`Pracownicy` (`idPracownicy`, `Imie`, `Nazwisko`, `Adres`, `Data_ur`, `Kontakt`, `Email`, `Dzial`, `Wyplata`, `Bonus`) VALUES (1, 'Paweł', 'Małysz', 'Olsztyn Iwaszkiewicza 12', '12.12.2019', 509234567, 'szlonypawel@gmail.com', 'Buty', 2500, 200);
INSERT INTO `klobuszenskij`.`Pracownicy` (`idPracownicy`, `Imie`, `Nazwisko`, `Adres`, `Data_ur`, `Kontakt`, `Email`, `Dzial`, `Wyplata`, `Bonus`) VALUES (2, 'Michał', 'Khaidov', 'Warszawa Wiktorska 23', '09.08.1995', 604635285, 'tonieja@wp.pl', 'Kasa', 2200, 100);
INSERT INTO `klobuszenskij`.`Pracownicy` (`idPracownicy`, `Imie`, `Nazwisko`, `Adres`, `Data_ur`, `Kontakt`, `Email`, `Dzial`, `Wyplata`, `Bonus`) VALUES (3, 'Kacper', 'Dreszer', 'Poznań Traugutta 22', '04.01.1967', 648725549, 'kacperek238@o2.pl', 'Wyżej', 2700, 200);
INSERT INTO `klobuszenskij`.`Pracownicy` (`idPracownicy`, `Imie`, `Nazwisko`, `Adres`, `Data_ur`, `Kontakt`, `Email`, `Dzial`, `Wyplata`, `Bonus`) VALUES (4, 'Sandra', 'Michalska', 'Olsztyn Mazurska 77', '11.11.1985', 502374655, 'sanderkaessa@gmail.com', 'Pomoc', 2300, 300);
INSERT INTO `klobuszenskij`.`Pracownicy` (`idPracownicy`, `Imie`, `Nazwisko`, `Adres`, `Data_ur`, `Kontakt`, `Email`, `Dzial`, `Wyplata`, `Bonus`) VALUES (5, 'Adrian', 'Lepiński', 'Dywity Jeżynowa 4', '22.01.1990', 683647583, 'lepanaoko@gmail.com', 'Magazyn', 300, 0);
INSERT INTO `klobuszenskij`.`Pracownicy` (`idPracownicy`, `Imie`, `Nazwisko`, `Adres`, `Data_ur`, `Kontakt`, `Email`, `Dzial`, `Wyplata`, `Bonus`) VALUES (6, 'Marian', 'Kakao', 'Kieźliny Jagałły 4', '13.02.1998', 746284555, 'kakaowymarian@wp.pl', 'Bar', 3100, 150);

COMMIT;


-- -----------------------------------------------------
-- Data for table `klobuszenskij`.`Klienci`
-- -----------------------------------------------------
START TRANSACTION;
USE `klobuszenskij`;
INSERT INTO `klobuszenskij`.`Klienci` (`idKlienci`, `Imie`, `Nawisko`, `Kontakt`, `Email`, `HistoriaRezerwacji`, `PESEL`, `IloscOsob`) VALUES (1, 'Antek', 'Apapa', 384723634, 'kalwiatur@gmail.com', 'BRAK', 72638457263, 3);
INSERT INTO `klobuszenskij`.`Klienci` (`idKlienci`, `Imie`, `Nawisko`, `Kontakt`, `Email`, `HistoriaRezerwacji`, `PESEL`, `IloscOsob`) VALUES (2, 'Halina', 'Szybka', 928374612, 'kapitantorpeda@wp.pl', 'BRAK', 63548273642, 2);
INSERT INTO `klobuszenskij`.`Klienci` (`idKlienci`, `Imie`, `Nawisko`, `Kontakt`, `Email`, `HistoriaRezerwacji`, `PESEL`, `IloscOsob`) VALUES (3, 'Grzegorz', 'Talarek', 502817362, 'dapan3@student.uwm.edu.pl', 'BRAK', 20384756291, 2);
INSERT INTO `klobuszenskij`.`Klienci` (`idKlienci`, `Imie`, `Nawisko`, `Kontakt`, `Email`, `HistoriaRezerwacji`, `PESEL`, `IloscOsob`) VALUES (4, 'Michalina', 'Jamajka', 826452735, 'szloneliczby@o2.pl', 'BRAK', 28374625183, 4);

COMMIT;


-- -----------------------------------------------------
-- Data for table `klobuszenskij`.`Sprzet`
-- -----------------------------------------------------
START TRANSACTION;
USE `klobuszenskij`;
INSERT INTO `klobuszenskij`.`Sprzet` (`idSprzet`, `Nazwa`, `MaxGraczy`, `IdPracownicy`, `idKlienci`) VALUES (1, 'Stół Bilardowy', 4, '4', 1);
INSERT INTO `klobuszenskij`.`Sprzet` (`idSprzet`, `Nazwa`, `MaxGraczy`, `IdPracownicy`, `idKlienci`) VALUES (2, 'Tor1', 6, '4', 2);
INSERT INTO `klobuszenskij`.`Sprzet` (`idSprzet`, `Nazwa`, `MaxGraczy`, `IdPracownicy`, `idKlienci`) VALUES (3, 'Tor2', 6, '4', 3);
INSERT INTO `klobuszenskij`.`Sprzet` (`idSprzet`, `Nazwa`, `MaxGraczy`, `IdPracownicy`, `idKlienci`) VALUES (4, 'Tor3', 4, '4', 4);

COMMIT;


-- -----------------------------------------------------
-- Data for table `klobuszenskij`.`Rezerwacja`
-- -----------------------------------------------------
START TRANSACTION;
USE `klobuszenskij`;
INSERT INTO `klobuszenskij`.`Rezerwacja` (`idRezerwacja`, `idKlienci`, `idSprzet`, `Rozpoczecie`, `Zakonczenie`) VALUES (1, 2, 2, DEFAULT, DEFAULT);
INSERT INTO `klobuszenskij`.`Rezerwacja` (`idRezerwacja`, `idKlienci`, `idSprzet`, `Rozpoczecie`, `Zakonczenie`) VALUES (2, 3, 3, DEFAULT, DEFAULT);
INSERT INTO `klobuszenskij`.`Rezerwacja` (`idRezerwacja`, `idKlienci`, `idSprzet`, `Rozpoczecie`, `Zakonczenie`) VALUES (3, 1, 1, DEFAULT, DEFAULT);
INSERT INTO `klobuszenskij`.`Rezerwacja` (`idRezerwacja`, `idKlienci`, `idSprzet`, `Rozpoczecie`, `Zakonczenie`) VALUES (4, 4, 4, DEFAULT, DEFAULT);

COMMIT;


-- -----------------------------------------------------
-- Data for table `klobuszenskij`.`MagazynBar`
-- -----------------------------------------------------
START TRANSACTION;
USE `klobuszenskij`;
INSERT INTO `klobuszenskij`.`MagazynBar` (`idBar`, `Nazwa`, `ZawAlk`, `Ilosc`) VALUES (1, 'Jagermeister', 35, 3);
INSERT INTO `klobuszenskij`.`MagazynBar` (`idBar`, `Nazwa`, `ZawAlk`, `Ilosc`) VALUES (2, 'Oranżada mazurska', 0, 15);
INSERT INTO `klobuszenskij`.`MagazynBar` (`idBar`, `Nazwa`, `ZawAlk`, `Ilosc`) VALUES (3, 'Ballantines', 40, 14);
INSERT INTO `klobuszenskij`.`MagazynBar` (`idBar`, `Nazwa`, `ZawAlk`, `Ilosc`) VALUES (4, 'Capi', 0, 23);
INSERT INTO `klobuszenskij`.`MagazynBar` (`idBar`, `Nazwa`, `ZawAlk`, `Ilosc`) VALUES (5, 'Johnny Silverhand', 99, 100);

COMMIT;


-- -----------------------------------------------------
-- Data for table `klobuszenskij`.`Bar`
-- -----------------------------------------------------
START TRANSACTION;
USE `klobuszenskij`;
INSERT INTO `klobuszenskij`.`Bar` (`Obsługa`) VALUES (6);

COMMIT;

